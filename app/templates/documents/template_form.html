{% extends "base.html" %}

{% block title %}{% if is_edit %}Editar{% else %}Nueva{% endif %} Plantilla - Constructora Rojoz{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css">
{% endblock %}

{% block content %}
<div class="p-8 max-w-3xl mx-auto space-y-8">

    <!-- Header -->
    <div class="flex items-center gap-4">
        <a href="{% url 'documents:template_list' %}" class="btn btn-ghost btn-sm">
            <i class="ri-arrow-left-line"></i>
        </a>
        <div>
            <h1 class="text-2xl font-bold text-gray-900" style="font-family: 'Playfair Display', serif;">
                {% if is_edit %}Editar Plantilla{% else %}Nueva Plantilla{% endif %}
            </h1>
            <p class="text-gray-600 text-sm mt-1">
                {% if is_edit %}Modifica los datos de la plantilla{% else %}Configura los datos básicos de la plantilla{% endif %}
            </p>
        </div>
    </div>

    <!-- Form -->
    <form method="post" class="card bg-white border border-gray-200 shadow-sm">
        {% csrf_token %}
        <div class="card-body space-y-6">

            <!-- Identidad -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="label"><span class="label-text font-medium">Nombre *</span></label>
                    <input type="text" name="name" value="{{ form.name.value|default:'' }}" class="input input-bordered w-full" placeholder="Ej: Contrato Principal" required>
                    {% if form.name.errors %}
                    <span class="text-error text-sm">{{ form.name.errors.0 }}</span>
                    {% endif %}
                </div>
                <div>
                    <label class="label"><span class="label-text font-medium">Slug *</span></label>
                    <input type="text" name="slug" value="{{ form.slug.value|default:'' }}" class="input input-bordered w-full font-mono text-sm" placeholder="contrato_principal" required>
                    {% if form.slug.errors %}
                    <span class="text-error text-sm">{{ form.slug.errors.0 }}</span>
                    {% endif %}
                </div>
            </div>

            <div>
                <label class="label"><span class="label-text font-medium">Ruta de publicación *</span></label>
                <input type="text" name="target_path" value="{{ form.target_path.value|default:'' }}" class="input input-bordered w-full font-mono text-sm" placeholder="contracts/venta.html" required>
                <p class="text-xs text-gray-500 mt-1">Ruta relativa dentro de DOCUMENTS_TEMPLATES_BASE_DIR</p>
                {% if form.target_path.errors %}
                <span class="text-error text-sm">{{ form.target_path.errors.0 }}</span>
                {% endif %}
            </div>

            <!-- Descripción -->
            <div>
                <label class="label"><span class="label-text font-medium">Descripción</span></label>
                <textarea name="description" class="textarea textarea-bordered w-full" rows="3" placeholder="Descripción de la plantilla">{{ form.description.value|default:'' }}</textarea>
            </div>

            <!-- Configuración de página -->
            <div class="divider">Configuración de Página</div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="label"><span class="label-text font-medium">Tamaño de página</span></label>
                    <select name="page_size" class="select select-bordered w-full">
                        {% for value, label in page_sizes %}
                        <option value="{{ value }}" {% if form.page_size.value == value or template.page_size == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="label"><span class="label-text font-medium">Orientación</span></label>
                    <select name="orientation" class="select select-bordered w-full">
                        {% for value, label in orientations %}
                        <option value="{{ value }}" {% if form.orientation.value == value or template.orientation == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Márgenes -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                    <label class="label"><span class="label-text text-sm">Margen superior (cm)</span></label>
                    <input type="number" name="margin_top" value="{{ form.margin_top.value|default:'2.5' }}" step="0.1" class="input input-bordered input-sm w-full">
                </div>
                <div>
                    <label class="label"><span class="label-text text-sm">Margen inferior (cm)</span></label>
                    <input type="number" name="margin_bottom" value="{{ form.margin_bottom.value|default:'2.5' }}" step="0.1" class="input input-bordered input-sm w-full">
                </div>
                <div>
                    <label class="label"><span class="label-text text-sm">Margen izquierdo (cm)</span></label>
                    <input type="number" name="margin_left" value="{{ form.margin_left.value|default:'2.0' }}" step="0.1" class="input input-bordered input-sm w-full">
                </div>
                <div>
                    <label class="label"><span class="label-text text-sm">Margen derecho (cm)</span></label>
                    <input type="number" name="margin_right" value="{{ form.margin_right.value|default:'2.0' }}" step="0.1" class="input input-bordered input-sm w-full">
                </div>
            </div>

            <!-- Estado -->
            <div>
                <label class="label cursor-pointer justify-start gap-3">
                    <input type="checkbox" name="is_active" class="checkbox checkbox-sm" {% if form.is_active.value or not is_edit %}checked{% endif %}>
                    <span class="label-text">Plantilla activa</span>
                </label>
            </div>

            <!-- Acciones -->
            <div class="flex justify-end gap-3 pt-4 border-t border-gray-100">
                <a href="{% url 'documents:template_list' %}" class="btn btn-ghost">Cancelar</a>
                <button type="submit" class="btn bg-rojoz-600 hover:bg-rojoz-700 text-white border-none">
                    {% if is_edit %}
                    <i class="ri-save-line mr-2"></i> Guardar Cambios
                    {% else %}
                    <i class="ri-add-line mr-2"></i> Crear y Editar
                    {% endif %}
                </button>
            </div>

        </div>
    </form>

</div>
{% endblock %}
