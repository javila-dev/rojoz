{% load humanize %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Liquidación de comisiones {{ liquidation_day|date:"Y-m-d" }}</title>
    <style>
        @page { size: A4; margin: 10mm 18mm 18mm 18mm; }
        * { box-sizing: border-box; }
        body { font-family: Arial, sans-serif; color: #111827; font-size: 11px; line-height: 1.45; }
        .page-title { text-align: center; text-transform: uppercase; font-size: 17px; font-weight: 700; margin-bottom: 4px; }
        .doc-number { text-align: center; font-size: 11px; margin-bottom: 10px; }
        .line-row { display: flex; gap: 12px; margin-bottom: 8px; }
        .line-item { flex: 1; border-bottom: 1px solid #9ca3af; padding-bottom: 4px; }
        .label { text-transform: uppercase; font-size: 9px; color: #6b7280; margin-bottom: 2px; }
        .value { font-size: 11px; font-weight: 600; }
        .box { border: 1px solid #d1d5db; padding: 12px; margin-bottom: 12px; }
        .box h3 { margin: 0 0 8px 0; font-size: 12px; text-transform: uppercase; }
        .paragraph { margin-top: 12px; text-align: justify; line-height: 1.6; }
        .sign-block { margin-top: 40px; }
        .sign-line { border-top: 1px solid #111827; width: 280px; padding-top: 6px; }
        .muted { color: #6b7280; font-size: 10px; }
        .page-break { page-break-before: always; }
        .table { width: 100%; border-collapse: collapse; margin-top: 8px; margin-bottom: 14px; }
        .table th, .table td { border: 1px solid #e5e7eb; padding: 6px 7px; font-size: 9px; vertical-align: top; }
        .table th { background: #f3f4f6; text-transform: uppercase; color: #374151; text-align: left; }
        .text-right { text-align: right; }

        .receipt-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #A0372A; padding-bottom: 10px; margin-bottom: 14px; }
        .receipt-brand { display: flex; align-items: center; gap: 10px; }
        .receipt-logo { width: 52px; height: 52px; border-radius: 8px; object-fit: contain; }
        .receipt-title { font-size: 17px; font-weight: 800; color: #A0372A; }
        .receipt-sub { font-size: 10px; color: #6b7280; }
        .receipt-num { text-align: right; }
        .receipt-num .main { font-size: 20px; font-weight: 800; }
        .amount-highlight { background: linear-gradient(135deg, #A0372A, #C4574E); color: #fff; border-radius: 10px; padding: 14px 16px; margin-bottom: 14px; }
        .amount-highlight .label { color: #fce8e5; margin-bottom: 4px; }
        .amount-highlight .value { color: #fff; font-size: 28px; font-weight: 800; }
        .receipt-footer { margin-top: 20px; border-top: 1px dashed #d1d5db; padding-top: 10px; font-size: 10px; color: #6b7280; }
    </style>
</head>
<body>
    <section>
        <h1 class="page-title">Cuenta de cobro</h1>
        <p class="doc-number">No. {{ account_number }}</p>

        <div class="line-row">
            <div class="line-item">
                <div class="label">Ciudad</div>
                <div class="value">{{ city }}</div>
            </div>
            <div class="line-item">
                <div class="label">Fecha de emisión</div>
                <div class="value">{{ issue_date|date:"d/m/Y" }}</div>
            </div>
        </div>

        <div class="box">
            <h3>Datos del cobrador</h3>
            <div class="line-row">
                <div class="line-item">
                    <div class="label">Nombre completo</div>
                    <div class="value">{{ advisor.get_full_name|default:advisor.username }}</div>
                </div>
                <div class="line-item">
                    <div class="label">NIT</div>
                    <div class="value">{{ advisor.nit|default:"No registrado" }}</div>
                </div>
            </div>
            <div class="line-row">
                <div class="line-item">
                    <div class="label">Correo</div>
                    <div class="value">{{ advisor.email|default:"No registrado" }}</div>
                </div>
                <div class="line-item">
                    <div class="label">Teléfono</div>
                    <div class="value">{{ advisor.phone|default:"No registrado" }}</div>
                </div>
            </div>
            <div class="line-row">
                <div class="line-item">
                    <div class="label">Banco</div>
                    <div class="value">{{ advisor.get_bank_code_display|default:"No registrado" }}</div>
                </div>
                <div class="line-item">
                    <div class="label">Tipo y número de cuenta</div>
                    <div class="value">{{ advisor.get_account_type_display|default:"" }} {{ advisor.account_number|default:"No registrado" }}</div>
                </div>
            </div>
        </div>

        <div class="box">
            <h3>Datos del pagador</h3>
            <div class="line-row">
                <div class="line-item">
                    <div class="label">Razón social</div>
                    <div class="value">{{ company_name }}</div>
                </div>
                <div class="line-item">
                    <div class="label">NIT</div>
                    <div class="value">{{ company_nit }}</div>
                </div>
            </div>
            <div class="line-row">
                <div class="line-item">
                    <div class="label">Dirección</div>
                    <div class="value">{{ company_address }}</div>
                </div>
                <div class="line-item">
                    <div class="label">Ciudad</div>
                    <div class="value">{{ company_city }}</div>
                </div>
            </div>
        </div>

        <div class="box">
            <h3>Concepto del cobro</h3>
            <p>
                Cobro consolidado por comisiones liquidadas el día {{ liquidation_day|date:"d/m/Y" }},
                correspondiente a {{ payments_count }} liquidación{{ payments_count|pluralize:"es" }} registradas en el sistema.
            </p>
            <div class="line-row" style="margin-top: 10px;">
                <div class="line-item">
                    <div class="label">Valor total a cobrar</div>
                    <div class="value">${{ total_amount|floatformat:0|intcomma }} COP</div>
                </div>
                <div class="line-item">
                    <div class="label">Referencia</div>
                    <div class="value">Liquidación diaria {{ liquidation_day|date:"Y-m-d" }}</div>
                </div>
            </div>
        </div>

        <p class="paragraph">
            Declaro bajo gravedad de juramento que la presente cuenta de cobro corresponde a servicios efectivamente
            prestados y que cumplo con las obligaciones tributarias aplicables conforme a la normatividad colombiana.
            Este documento se emite para el trámite interno de pago y como soporte para que el adquirente elabore,
            cuando aplique, el documento soporte en adquisiciones a no obligados a facturar.
        </p>
        <br><br>
        <div class="sign-block">
            <div class="sign-line">
                <strong>{{ advisor.get_full_name|default:advisor.username }}</strong><br>
                <span class="muted">Firma / NIT: {{ advisor.nit|default:"No registrado" }}</span>
            </div>
        </div>
    </section>

    <section class="page-break">
        <div class="receipt-header">
            <div class="receipt-brand">
                <img src="{{ company_logo_url }}" alt="Rojoz" class="receipt-logo">
                <div>
                    <div class="receipt-title">{{ company_name }}</div>
                    <div class="receipt-sub">Recibo de caja consolidado por comisiones del día</div>
                </div>
            </div>
            <div class="receipt-num">
                <div class="label">Recibo No.</div>
                <div class="main">{{ cash_receipt_number }}</div>
                <div class="receipt-sub">{{ issue_date|date:"d/m/Y" }}</div>
            </div>
        </div>

        <div class="amount-highlight">
            <div class="label">Valor total entregado</div>
            <div class="value">${{ total_amount|floatformat:0|intcomma }}</div>
        </div>

        <p class="paragraph" style="margin-top: 0; margin-bottom: 10px;">
            El presente recibo de caja certifica la entrega y recepción del valor correspondiente a la
            liquidación consolidada de comisiones del día {{ liquidation_day|date:"d/m/Y" }}.
            A continuación se relacionan los pagos incluidos en esta liquidación.
        </p>

        <div class="box" style="margin-bottom: 10px;">
            <div class="line-row">
                <div class="line-item">
                    <div class="label">Nombre de quien recibe</div>
                    <div class="value">{{ advisor.get_full_name|default:advisor.username }}</div>
                </div>
                <div class="line-item">
                    <div class="label">Fecha de recibido</div>
                    <div class="value">{{ issue_date|date:"d/m/Y" }}</div>
                </div>
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>Liquidación</th>
                    <th>Proyecto</th>
                    <th>Contrato</th>
                    <th>Cargo</th>
                    <th>Motivo</th>
                    <th class="text-right">Valor</th>
                </tr>
            </thead>
            <tbody>
                {% for item in payments %}
                <tr>
                    <td>#{{ item.pk }}</td>
                    <td>{{ item.participant.sale.project.name }}</td>
                    <td>#{{ item.participant.sale.contract_number|default:item.participant.sale.id|truncatechars:12 }}</td>
                    <td>{{ item.participant.role }}</td>
                    <td>{{ item.trigger }}</td>
                    <td class="text-right">${{ item.amount_paid|floatformat:0|intcomma }}</td>
                </tr>
                {% endfor %}
                <tr>
                    <td colspan="5" class="text-right"><strong>Total</strong></td>
                    <td class="text-right"><strong>${{ total_amount|floatformat:0|intcomma }}</strong></td>
                </tr>
            </tbody>
        </table>
        
        <div class="line-row" style="margin-top: 30px;">
            <div class="line-item" style="margin-right: 20px;">
                <div class="label">Firma tesorería</div><br><br>
                <div style="height: 36px;"></div>
            </div>
            <div class="line-item">
                <div class="label">Firma beneficiario</div>
                <div style="height: 36px;"></div><br><br>
            </div>
        </div>

        <div class="receipt-footer">
            Documento de soporte interno para la entrega de dinero correspondiente a liquidaciones de comisiones del día.
        </div>
    </section>
</body>
</html>
